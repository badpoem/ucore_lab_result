练习0

- 使用meld对实验1 2 3编写的代码merge到实验4代码中。

>

练习1

设计实现过程：

- 实现在注释中已经很详细地进行了说明。为进程proc相应的各成员变量进行初始化，相应赋值即可。

>

页目录项（Pag Director Entry）和页表（Page Table Entry）中组成部分对ucore实现页替换算法的潜在用处：

- 页表项中的标志位如PTE_P、PTE_W、PTE_U，可以用来识别触发缺页异常的类型，即是越权访问还是缺页。而PTE_A与PTE_D作为标志位，在实现页替换算法的时候，可以用来记录是否被访问或是被改写过，用于选择换出的页。

>

ucore的缺页服务例程在执行过程中访问内存，出现了页访问异常，硬件要做的事情：

- 硬件需要再次触发缺页异常，保存现场，然后跳转到double fault处理例程。

>

练习2

设计实现过程：

- ①对于do_pgfault函数的剩余部分，承接练习1而来，若页表项不为0则说明是被换出到磁盘上，则此时其地址位表示磁盘扇区，调用swap_in函数将其调入内存中即可。
- ②对于map_swappable和swap_out_vistim函数，分配一个页的时候，就将其添加到pra_list中head指针的前面。因为是一个循环链表，所以就相当于加入到了链表的尾部。换出victim的时候将紧跟head之后的一页剔除即可。

>

extended clock页替换算法的设计方案及相关问题：

- 当前的ucore足以支撑extended clock算法的实现，类似fifo，利用pra_list循环链表，以页表项中的PTE_A(accessed)与PTE_D(dirty)位作为页是否被访问过或是被写过的标志位。在swap_manager中访问标志位，取得实际页面与页表项的对应关系，同时可以修改标志位即可。
- 问题①：链表中最靠前且未被访问或是写过的页。
- 问题②：遍历pra_list循环链表，其中页表项中的PTE_A表示是否被访问过，PTE_D表示是否被写过。
- 问题③：缺页时换入换出。

>

区别于参考答案：

- 没有太大的区别。因为注释已经非常详细。只是因为pra_list是循环链表，所以page插入到head前与后产生了差异，但是实际效果是等同的。

>

实验知识点

- 如何处理page fault异常
- 页面替换算法的实现

>

OS原理知识点

- 如何实现全局置换算法

>
